<Window x:Class="EasyYachiyoClient.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:EasyYachiyoClient"
        xmlns:vm="clr-namespace:EasyYachiyoClient.ViewModel"
        mc:Ignorable="d"
        Title="八千代模型"
        Height="600"
        Width="900"
        WindowStyle="None"
        AllowsTransparency="True"
        Background="Transparent"
        ResizeMode="NoResize"
        Icon="/resource/window_title_icon.jpg">
    <Window.DataContext>
        <vm:MainViewModel/>
    </Window.DataContext>
    <Window.Resources>
        <DropShadowEffect x:Key="DropShadowEffect"
                          BlurRadius="10"
                          ShadowDepth="3"
                          Opacity="0.3"
                          Direction="270"/>
        
        <!-- 动画资源 -->
        <QuadraticEase x:Key="QuadraticEase" EasingMode="EaseInOut"/>
        <DoubleAnimation x:Key="FadeInAnimation" Storyboard.TargetProperty="Opacity" From="0" To="1" Duration="0:0:0.3"/>
        <DoubleAnimation x:Key="FadeOutAnimation" Storyboard.TargetProperty="Opacity" From="1" To="0" Duration="0:0:0.3"/>
        <Duration x:Key="ShortAnimationDuration">0:0:0.2</Duration>
        <Duration x:Key="VeryShortAnimationDuration">0:0:0.1</Duration>
        
        <!-- 转换器 -->
        <local:BoolToHorizontalAlignmentConverter x:Key="BoolToHorizontalAlignmentConverter"/>
        <local:BoolToBackgroundConverter x:Key="BoolToBackgroundConverter"/>
        <local:BoolToBorderBrushConverter x:Key="BoolToBorderBrushConverter"/>
        <local:BoolToConversationBackgroundConverter x:Key="BoolToConversationBackgroundConverter"/>
        
        <Style x:Key="RoundedButtonStyle" TargetType="Button">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Grid x:Name="ButtonGrid">
                                        <Border 
                                            x:Name="ButtonBorder"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="8"
                                            Padding="10,5"
                                            SnapsToDevicePixels="True">
                                <Border.RenderTransform>
                                    <ScaleTransform ScaleX="1" ScaleY="1"/>
                                </Border.RenderTransform>
                                <ContentPresenter 
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                            </Border>
                            <!-- 波纹效果 -->
                            <Ellipse 
                                x:Name="Ripple"
                                Fill="White"
                                Opacity="0"
                                RenderTransformOrigin="0.5,0.5"
                                Width="{Binding ActualWidth, ElementName=ButtonGrid}"
                                Height="{Binding ActualHeight, ElementName=ButtonGrid}">
                                <Ellipse.RenderTransform>
                                    <ScaleTransform ScaleX="0" ScaleY="0"/>
                                </Ellipse.RenderTransform>
                            </Ellipse>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard Name="HoverStoryboard">
                                        <Storyboard>
                                            <!-- 颜色变化 -->
                                            <ColorAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                To="#0088D1"
                                                Duration="0:0:0.3"/>
                                            <!-- 缩放效果 -->
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                To="1.02"
                                                Duration="0:0:0.3"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                To="1.02"
                                                Duration="0:0:0.3"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                            <!-- 波纹动画 -->
                                            <DoubleAnimation 
                                                Storyboard.TargetName="Ripple"
                                                Storyboard.TargetProperty="Opacity"
                                                From="0" To="0.3" Duration="0:0:0.1"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="Ripple"
                                                Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleX)"
                                                From="0" To="2" Duration="0:0:0.8"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="Ripple"
                                                Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleY)"
                                                From="0" To="2" Duration="0:0:0.8"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="Ripple"
                                                Storyboard.TargetProperty="Opacity"
                                                From="0.3" To="0" Duration="0:0:0.8"
                                                BeginTime="0:0:0.1"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- 颜色恢复 -->
                                            <ColorAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                To="#0077BE"
                                                Duration="0:0:0.3"/>
                                            <!-- 缩放恢复 -->
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                To="1"
                                                Duration="0:0:0.3"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                To="1"
                                                Duration="0:0:0.3"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                            <!-- 波纹淡出 -->
                                            <DoubleAnimation 
                                                Storyboard.TargetName="Ripple"
                                                Storyboard.TargetProperty="Opacity"
                                                To="0"
                                                Duration="0:0:0.3"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="Ripple"
                                                Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleX)"
                                                To="0"
                                                Duration="0:0:0.3"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="Ripple"
                                                Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleY)"
                                                To="0"
                                                Duration="0:0:0.3"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Trigger.EnterActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- 颜色变化 -->
                                            <ColorAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                To="#0066A3"
                                                Duration="0:0:0.3"/>
                                            <!-- 缩放效果 -->
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                To="0.98"
                                                Duration="0:0:0.3"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                To="0.98"
                                                Duration="0:0:0.3"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.EnterActions>
                                <Trigger.ExitActions>
                                    <BeginStoryboard>
                                        <Storyboard>
                                            <!-- 颜色恢复 -->
                                            <ColorAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.Background).(SolidColorBrush.Color)"
                                                To="#0088D1"
                                                Duration="0:0:0.3"/>
                                            <!-- 缩放恢复 -->
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                To="1.02"
                                                Duration="0:0:0.3"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                            <DoubleAnimation 
                                                Storyboard.TargetName="ButtonBorder"
                                                Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                To="1.02"
                                                Duration="0:0:0.3"
                                                EasingFunction="{StaticResource QuadraticEase}"/>
                                        </Storyboard>
                                    </BeginStoryboard>
                                </Trigger.ExitActions>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Background" Value="#0077BE"/>
            <Setter Property="BorderBrush" Value="#0077BE"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="White"/>
        </Style>
        <Style x:Key="RoundedTextBoxStyle" TargetType="TextBox">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Border 
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            CornerRadius="8"
                            Padding="10"
                            SnapsToDevicePixels="True">
                            <ScrollViewer 
                                Margin="0"
                                x:Name="PART_ContentHost"
                                SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="RoundedPanelStyle" TargetType="Border">
            <Setter Property="Background" Value="White"/>
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="12"/>
        </Style>
    </Window.Resources>
    <Grid>
        <!-- 淡蓝色10%透明后景 -->
        <Border 
            Background="#19E0F8FF" 
            CornerRadius="12"
            Margin="10"
            Panel.ZIndex="-1"/>
        <Border 
            Background="Transparent"
            CornerRadius="12"
            Effect="{StaticResource DropShadowEffect}"
            Margin="10"
            RenderOptions.BitmapScalingMode="LowQuality"
            RenderOptions.ClearTypeHint="Enabled">
            <Grid>
                <!-- 标题栏 -->
                <Grid x:Name="TitleBar" Height="140" VerticalAlignment="Top" Background="Transparent">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <!-- 软件图标和标题 -->
                    <Border 
                        Grid.Column="0"
                        Width="192"
                        Height="108"
                        Margin="15,10"
                        Background="#E0E0E0"
                        CornerRadius="8">
                        <Image 
                            Source="/resource/big_window_icon.jpg"
                            Stretch="UniformToFill"
                            Margin="2">
                            <Image.Clip>
                                <RectangleGeometry RadiusX="6" RadiusY="6" Rect="0,0,188,104"/>
                            </Image.Clip>
                        </Image>
                    </Border>
                    <Border 
                        Grid.Column="1"
                        Background="White"
                        BorderBrush="#E0E0E0"
                        BorderThickness="1"
                        CornerRadius="8"
                        Padding="16,8"
                        VerticalAlignment="Top"
                        Margin="10,15"
                        HorizontalAlignment="Left">
                        <TextBlock 
                            Text="月见八千代"
                            FontSize="20"
                            FontWeight="Medium"/>
                    </Border>
                    <!-- 窗口控制按钮 -->
                    <StackPanel 
                        Grid.Column="2"
                        Orientation="Horizontal"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        Margin="10,15">
                        <Button 
                            Width="40"
                            Height="40"
                            Margin="8,0"
                            Background="Transparent"
                            BorderBrush="#0077BE"
                            BorderThickness="1"
                            Foreground="White"
                            Command="{Binding SettingsCommand}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Grid x:Name="ButtonGrid">
                                        <Border 
                                            x:Name="ButtonBorder"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="20"
                                            SnapsToDevicePixels="True">
                                            <Border.RenderTransform>
                                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                                            </Border.RenderTransform>
                                            <ContentPresenter 
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                        </Border>
                                        <Ellipse 
                                            x:Name="Ripple"
                                            Fill="White"
                                            Opacity="0"
                                            RenderTransformOrigin="0.5,0.5"
                                            Width="{Binding ActualWidth, ElementName=ButtonGrid}"
                                            Height="{Binding ActualHeight, ElementName=ButtonGrid}">
                                            <Ellipse.RenderTransform>
                                                <ScaleTransform ScaleX="0" ScaleY="0"/>
                                            </Ellipse.RenderTransform>
                                        </Ellipse>
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard Name="HoverStoryboard">
                                                    <Storyboard>
                                                        <!-- 边框颜色变化 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#0088D1"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放效果 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <!-- 波纹动画 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="Opacity"
                                                            From="0" To="0.3" Duration="0:0:0.1"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleX)"
                                                            From="0" To="2" Duration="0:0:0.8"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleY)"
                                                            From="0" To="2" Duration="0:0:0.8"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="Opacity"
                                                            From="0.3" To="0" Duration="0:0:0.8"
                                                            BeginTime="0:0:0.1"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                            <Trigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- 边框颜色恢复 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#0077BE"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放恢复 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="1"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="1"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <!-- 波纹淡出 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="Opacity"
                                                            To="0"
                                                            Duration="0:0:0.3"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="0"
                                                            Duration="0:0:0.3"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="0"
                                                            Duration="0:0:0.3"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.ExitActions>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- 边框颜色变化 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#0066A3"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放效果 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="0.98"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="0.98"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                            <Trigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- 边框颜色恢复 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#0088D1"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放恢复 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.ExitActions>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                            <Image 
                                Source="/resource/set.png"
                                Stretch="Uniform"/>
                        </Button>
                        <Button 
                            Width="40"
                            Height="40"
                            Margin="8,0"
                            Background="Transparent"
                            BorderBrush="#0077BE"
                            BorderThickness="1"
                            Foreground="White"
                            Command="{Binding MinimizeCommand}"
                            CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Grid x:Name="ButtonGrid">
                                        <Border 
                                            x:Name="ButtonBorder"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="20"
                                            SnapsToDevicePixels="True">
                                            <Border.RenderTransform>
                                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                                            </Border.RenderTransform>
                                            <ContentPresenter 
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                        </Border>
                                        <Ellipse 
                                            x:Name="Ripple"
                                            Fill="White"
                                            Opacity="0"
                                            RenderTransformOrigin="0.5,0.5"
                                            Width="{Binding ActualWidth, ElementName=ButtonGrid}"
                                            Height="{Binding ActualHeight, ElementName=ButtonGrid}">
                                            <Ellipse.RenderTransform>
                                                <ScaleTransform ScaleX="0" ScaleY="0"/>
                                            </Ellipse.RenderTransform>
                                        </Ellipse>
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard Name="HoverStoryboard">
                                                    <Storyboard>
                                                        <!-- 边框颜色变化 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#0088D1"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放效果 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <!-- 波纹动画 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="Opacity"
                                                            From="0" To="0.3" Duration="0:0:0.1"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleX)"
                                                            From="0" To="2" Duration="0:0:0.8"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleY)"
                                                            From="0" To="2" Duration="0:0:0.8"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="Opacity"
                                                            From="0.3" To="0" Duration="0:0:0.8"
                                                            BeginTime="0:0:0.1"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                            <Trigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- 边框颜色恢复 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#0077BE"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放恢复 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="1"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="1"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <!-- 波纹淡出 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="Opacity"
                                                            To="0"
                                                            Duration="0:0:0.3"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="0"
                                                            Duration="0:0:0.3"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="0"
                                                            Duration="0:0:0.3"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.ExitActions>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- 边框颜色变化 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#0066A3"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放效果 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="0.98"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="0.98"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                            <Trigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- 边框颜色恢复 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#0088D1"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放恢复 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.ExitActions>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                            <Image 
                                Source="/resource/minimize.png"
                                Stretch="Uniform"/>
                        </Button>
                        <Button 
                            Width="40"
                            Height="40"
                            Margin="8,0"
                            Background="Transparent"
                            BorderBrush="#E74C3C"
                            BorderThickness="1"
                            Foreground="White"
                            Command="{Binding CloseCommand}"
                            CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}">
                            <Button.Template>
                                <ControlTemplate TargetType="Button">
                                    <Grid x:Name="ButtonGrid">
                                        <Border 
                                            x:Name="ButtonBorder"
                                            Background="{TemplateBinding Background}"
                                            BorderBrush="{TemplateBinding BorderBrush}"
                                            BorderThickness="{TemplateBinding BorderThickness}"
                                            CornerRadius="20"
                                            SnapsToDevicePixels="True">
                                            <Border.RenderTransform>
                                                <ScaleTransform ScaleX="1" ScaleY="1"/>
                                            </Border.RenderTransform>
                                            <ContentPresenter 
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
                                        </Border>
                                        <Ellipse 
                                            x:Name="Ripple"
                                            Fill="White"
                                            Opacity="0"
                                            RenderTransformOrigin="0.5,0.5"
                                            Width="{Binding ActualWidth, ElementName=ButtonGrid}"
                                            Height="{Binding ActualHeight, ElementName=ButtonGrid}">
                                            <Ellipse.RenderTransform>
                                                <ScaleTransform ScaleX="0" ScaleY="0"/>
                                            </Ellipse.RenderTransform>
                                        </Ellipse>
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard Name="HoverStoryboard">
                                                    <Storyboard>
                                                        <!-- 边框颜色变化 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#F39C12"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放效果 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <!-- 波纹动画 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="Opacity"
                                                            From="0" To="0.3" Duration="0:0:0.1"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleX)"
                                                            From="0" To="2" Duration="0:0:0.8"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleY)"
                                                            From="0" To="2" Duration="0:0:0.8"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="Opacity"
                                                            From="0.3" To="0" Duration="0:0:0.8"
                                                            BeginTime="0:0:0.1"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                            <Trigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- 边框颜色恢复 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#E74C3C"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放恢复 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="1"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="1"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <!-- 波纹淡出 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="Opacity"
                                                            To="0"
                                                            Duration="0:0:0.3"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="0"
                                                            Duration="0:0:0.3"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="Ripple"
                                                            Storyboard.TargetProperty="(Ellipse.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="0"
                                                            Duration="0:0:0.3"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.ExitActions>
                                        </Trigger>
                                        <Trigger Property="IsPressed" Value="True">
                                            <Trigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- 边框颜色变化 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#C0392B"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放效果 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="0.98"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="0.98"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.EnterActions>
                                            <Trigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <!-- 边框颜色恢复 -->
                                                        <ColorAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.BorderBrush).(SolidColorBrush.Color)"
                                                            To="#F39C12"
                                                            Duration="0:0:0.3"/>
                                                        <!-- 缩放恢复 -->
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleX)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                        <DoubleAnimation 
                                                            Storyboard.TargetName="ButtonBorder"
                                                            Storyboard.TargetProperty="(Border.RenderTransform).(ScaleTransform.ScaleY)"
                                                            To="1.02"
                                                            Duration="0:0:0.3"
                                                            EasingFunction="{StaticResource QuadraticEase}"/>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </Trigger.ExitActions>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Button.Template>
                            <Image 
                                Source="/resource/close.png"
                                Stretch="Uniform"/>
                        </Button>
                    </StackPanel>
                </Grid>
                <!-- 主内容区域 -->
                <Grid Margin="0,140,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="250"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    <!-- 对话选择区 -->
                    <Border 
                        Grid.Column="0"
                        Style="{StaticResource RoundedPanelStyle}"
                        Margin="15,5,10,15">
                        <Grid>
                            <TextBlock 
                                Text="对话选择"
                                FontSize="14"
                                FontWeight="Medium"
                                Margin="15,15,15,5"/>
                            <ListBox 
                                Margin="15,45,15,60"
                                ItemsSource="{Binding Conversations}"
                                SelectedItem="{Binding SelectedConversation, Mode=TwoWay}"
                                VerticalContentAlignment="Stretch"
                                HorizontalContentAlignment="Stretch">
                                <ListBox.ItemTemplate>
                                    <DataTemplate>
                                        <Border x:Name="ItemBorder"
                                            BorderBrush="Transparent"
                                            BorderThickness="0"
                                            CornerRadius="6"
                                            Padding="10"
                                            Margin="0,0,0,5">
                                            <TextBlock 
                                                Text="{Binding Title}"
                                                FontSize="14"
                                                FontWeight="Medium"/>
                                            <Border.Style>
                                                <Style TargetType="Border">
                                                    <Setter Property="Background" Value="#F0F0F0"/>
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsSelected, RelativeSource={RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem}}}" Value="True">
                                                            <Setter Property="Background" Value="#ADD8E6"/>
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Border.Style>
                                        </Border>
                                    </DataTemplate>
                                </ListBox.ItemTemplate>
                                <ListBox.ItemContainerStyle>
                                    <Style TargetType="ListBoxItem">
                                        <Setter Property="Background" Value="Transparent"/>
                                        <Setter Property="BorderBrush" Value="Transparent"/>
                                        <Setter Property="BorderThickness" Value="0"/>
                                        <Setter Property="Padding" Value="0"/>
                                        <Setter Property="Margin" Value="0"/>
                                        <Setter Property="Template">
                                            <Setter.Value>
                                                <ControlTemplate TargetType="ListBoxItem">
                                                    <Border x:Name="ItemBorder" Background="Transparent">
                                                        <ContentPresenter />
                                                    </Border>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </ListBox.ItemContainerStyle>
                                <ListBox.Template>
                                    <ControlTemplate TargetType="ListBox">
                                        <Border 
                                            Background="Transparent"
                                            BorderBrush="Transparent"
                                            BorderThickness="0">
                                            <ScrollViewer 
                                                VerticalScrollBarVisibility="Auto"
                                                HorizontalScrollBarVisibility="Disabled">
                                                <ItemsPresenter/>
                                            </ScrollViewer>
                                        </Border>
                                    </ControlTemplate>
                                </ListBox.Template>
                            </ListBox>
                            <Button 
                                Width="40"
                                Height="40"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Bottom"
                                Margin="15"
                                Style="{StaticResource RoundedButtonStyle}"
                                Background="#0077BE"
                                Foreground="White"
                                BorderThickness="0"
                                Command="{Binding AddConversationCommand}">
                                <Button.Content>
                                    <TextBlock Text="+" FontSize="20" FontWeight="Bold"/>
                                </Button.Content>
                            </Button>
                        </Grid>
                    </Border>
                    <!-- 对话信息框和输入区 -->
                    <Grid Grid.Column="1" Margin="10,5,15,15">
                        <!-- 对话信息框 -->
                        <Border 
                            Style="{StaticResource RoundedPanelStyle}"
                            Margin="0,0,0,70">
                            <ScrollViewer 
                                Margin="15"
                                VerticalScrollBarVisibility="Auto">
                                <ItemsControl 
                                    ItemsSource="{Binding SelectedConversation.Messages}"
                                    VerticalContentAlignment="Stretch"
                                    HorizontalContentAlignment="Stretch">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid 
                                                Margin="0,0,0,15"
                                                HorizontalAlignment="{Binding IsUser, Converter={StaticResource BoolToHorizontalAlignmentConverter}}">
                                                <Border 
                                                    Background="{Binding IsUser, Converter={StaticResource BoolToBackgroundConverter}}"
                                                    BorderBrush="{Binding IsUser, Converter={StaticResource BoolToBorderBrushConverter}}"
                                                    BorderThickness="1"
                                                    CornerRadius="8"
                                                    Padding="12"
                                                    MaxWidth="700">
                                                    <StackPanel>
                                                        <TextBlock 
                                                            Text="{Binding Content}"
                                                            FontSize="14"
                                                            TextWrapping="Wrap"/>
                                                        <TextBlock 
                                                            Text="{Binding Timestamp, StringFormat='HH:mm'}"
                                                            FontSize="12"
                                                            Foreground="#808080"
                                                            HorizontalAlignment="Right"
                                                            Margin="0,5,0,0"/>
                                                    </StackPanel>
                                                </Border>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </ScrollViewer>
                        </Border>
                        <!-- 输入区 -->
                        <Grid 
                            Height="60"
                            VerticalAlignment="Bottom"
                            Margin="0,0,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="100"/>
                            </Grid.ColumnDefinitions>
                            <TextBox 
                                Grid.Column="0"
                                Style="{StaticResource RoundedTextBoxStyle}"
                                Background="White"
                                BorderBrush="#E0E0E0"
                                BorderThickness="1"
                                Margin="0,0,10,0"
                                TextWrapping="Wrap"
                                VerticalScrollBarVisibility="Auto"
                                Text="{Binding MessageText, Mode=TwoWay}"/>
                            <Button 
                                Grid.Column="1"
                                Style="{StaticResource RoundedButtonStyle}"
                                Background="#0077BE"
                                Foreground="White"
                                Content="发送"
                                Command="{Binding SendMessageCommand}"/>
                        </Grid>
                    </Grid>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>
